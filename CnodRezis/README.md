Переделать предыдущий код из conResistoh

Заменить delay(1000) в программах (например, на Arduino) можно с помощью функции millis() для неблокирующей задержки.
 Вместо того чтобы останавливать выполнение всей программы, вы используете millis(), чтобы отслеживать прошедшее время и выполнять нужные действия только после истечения заданного интервала (1000 миллисекунд, или 1 секунды). 


Как заменить delay() на millis()
Инициализация переменных:

Создайте две переменные: unsigned long previousMillis = 0; для хранения времени последнего события и const long interval = 1000; для заданного интервала задержки.

В основном цикле loop():
Получите текущее время с помощью unsigned long currentMillis = millis();.
Проверьте, прошло ли необходимое время: if (currentMillis - previousMillis >= interval).

Если да, то обновите время: previousMillis = currentMillis;.

После этого выполняйте нужный код, который раньше находился после delay(1000).


Структура кода:

Логика вынесена в отдельную функцию performCapacitanceMeasurement() — улучшена читаемость и сопровождаемость.
Убраны вложенные if, код стал линейным и понятным.
Читаемость и именование:

Переименованы переменные (timeMill → lastTime, condesator → CAPACITOR_CHECK_INTERVAL и т.д.) — теперь ясно, за что отвечает каждая.
Константы вынесены с пояснениями.
Логика измерения:

Добавлен этап разряда конденсатора перед каждым измерением — критически важен для точности.
Используется среднее время разряда для более стабильного результата.
Применена упрощённая формула C = t / (R * ln(3)) ≈ t / (R * 1.44).
Калибровка:

Калибровка нуля выполняется один раз при старте, если конденсатор не обнаружен.
Устранена ошибка yvs0=c+0,02 — в оригинале была синтаксическая ошибка (запятая вместо точки).
Отображение:

Результат выводится корректно: нФ или мкФ в зависимости от величины.
Добавлено сообщение "No Cap" при отсутствии конденсатора.
Экран очищается перед новым выводом — устранены артефакты.
Стабильность:

Добавлены небольшие задержки для завершения разряда.
Проверка времени заряда предотвращает зависание.
Исправление ошибок:

Устранена ошибка: if(mk==0){ ... if(mk==1) — внутри mk==0 невозможно mk==1, логика была сломана.
Убрана путаница с переключением пинов.